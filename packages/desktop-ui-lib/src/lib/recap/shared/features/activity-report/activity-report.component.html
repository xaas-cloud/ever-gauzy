<div class="weekly-logs row-table" [nbSpinner]="isLoading$ | async" nbSpinnerSize="giant"
  nbSpinnerStatus="primary">
  <ng-template #columnsHeader>
    <div class="columns-header">
      <div class="table-inner-wrapper font-weight-bold align-items-center">
        <div class="responsive-table-row project-column">
          {{ 'REPORT_PAGE.PROJECT' | translate }}
        </div>
        <div class="responsive-table-row title-column">
          {{ 'REPORT_PAGE.TITLE' | translate }}
        </div>
        <div class="responsive-table-row duration-column">
          {{ 'REPORT_PAGE.DURATION' | translate }}
        </div>
        <div class="responsive-table-row progress-bar-column"></div>
      </div>
    </div>
  </ng-template>
  @if ((dailyActivities$ | async)?.length > 0) {
    @for (day of dailyActivities$ | async; track day) {
      <nb-card class="card">
        <ng-container>
						<ng-container *ngTemplateOutlet="
								dailyEl;
								context: { $implicit: day }
							"></ng-container>
        </ng-container>
      </nb-card>
    }
  } @else {
    <ngx-no-data-message
    [message]="'REPORT_PAGE.NO_DATA.APP_AND_URL_ACTIVITY' | translate"></ngx-no-data-message>
  }
</div>

<ng-template let-day #dailyEl>
  <nb-card-header class="card-title">
    {{ day.date | dateTime: 'LL' }}
  </nb-card-header>
  <nb-card-body class="activities-container">
    <ng-container *ngTemplateOutlet="columnsHeader"></ng-container>
    @for (employeeRow of day.employees; track employeeRow; let employeeIndex = $index) {
      <div class="cart-body project-row">
        @for (projectRow of employeeRow.projects; track projectRow; let projectIndex = $index) {
          <div class="table-row-custom">
            @for (activityRow of projectRow.activity; track activityRow; let activityIndex = $index) {
              <div class="activity-row">
                <div class="table-inner-wrapper">
                  <div class="responsive-table-row project-column">
                    <div class="responsive-table-header">{{ 'REPORT_PAGE.PROJECT' | translate }}</div>
                    <div class="responsive-table-content project-name">
                      @if (activityIndex == 0) {
									<ng-container *ngTemplateOutlet="
										projectEl;
										context: { $implicit: projectRow?.project }">
                        </ng-container>
                      }
                    </div>
                  </div>
                  <div class="responsive-table-row title-column">
                    <div class="responsive-table-header">{{ 'REPORT_PAGE.TITLE' | translate }}</div>
                    <div class="responsive-table-content project-name title">
                      {{ activityRow?.title }}
                    </div>
                  </div>
                  <div class="responsive-table-row duration-column">
                    <div class="responsive-table-header">{{ 'REPORT_PAGE.DURATION' | translate }}</div>
                    <div class="responsive-table-content day-col duration">
                      {{ activityRow.duration | durationFormat }}
                    </div>
                  </div>
                  <div class="responsive-table-row progress-bar-column">
                    <div class="responsive-table-content day-col">
                      <ngx-progress-status [defaultStatus]="'success'" class="report-progress"
                        [percentage]="activityRow.duration_percentage">
                      </ngx-progress-status>
                    </div>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  </nb-card-body>
</ng-template>

<ng-template let-project #projectEl>
  @if (project) {
    <ga-project-column-view [project]="project"></ga-project-column-view>
  } @else {
    <span>{{ 'REPORT_PAGE.NO_PROJECT' | translate }}</span>
  }
</ng-template>
