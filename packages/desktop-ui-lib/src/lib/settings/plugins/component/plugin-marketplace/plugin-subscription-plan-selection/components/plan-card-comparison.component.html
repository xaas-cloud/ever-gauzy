<div
  class="plan-card"
  [class.current-plan]="comparisonInfo?.actionType === PlanActionType.CURRENT"
  [class.disabled]="comparisonInfo?.isDisabled"
  [class.upgrade]="comparisonInfo?.actionType === PlanActionType.UPGRADE"
  [class.downgrade]="comparisonInfo?.actionType === PlanActionType.DOWNGRADE"
  [class.new]="comparisonInfo?.actionType === PlanActionType.NEW"
  >
  <!-- Plan Header -->
  <div class="plan-header">
    <div class="plan-badges">
      @if (comparisonInfo?.badgeText) {
        <nb-badge
          [status]="comparisonInfo.badgeColor || 'basic'"
          position="top-right"
          >
          {{ comparisonInfo.badgeText }}
        </nb-badge>
      }
      @if (planViewModel.isPopular) {
        <nb-badge status="warning" position="top-left"> Popular </nb-badge>
      }
      @if (planViewModel.isRecommended) {
        <nb-badge status="success" position="top-left"> Recommended </nb-badge>
      }
    </div>
    <nb-icon [icon]="planViewModel.icon" [status]="planViewModel.colorStatus"></nb-icon>
    <h5>{{ planViewModel.name }}</h5>
    <p class="plan-description">{{ planViewModel.description }}</p>
  </div>

  <!-- Pricing Information -->
  <div class="plan-pricing">
    <div class="price-main">
      <span class="price">{{ planViewModel.formattedPrice }}</span>
      @if (!planViewModel.isFree) {
        <span class="period">/{{ planViewModel.formattedBillingPeriod }}</span>
      }
    </div>

    <!-- Proration Information for Upgrades -->
    @if (comparisonInfo?.prorationAmount && comparisonInfo.prorationAmount > 0) {
      <div class="proration-info">
        <small class="text-hint"> Prorated amount: {{ comparisonInfo.formattedProrationAmount }} </small>
      </div>
    }

    <!-- Trial Information -->
    @if (planViewModel.trialText) {
      <div class="trial-info">
        <small class="text-success">{{ planViewModel.trialText }}</small>
      </div>
    }
  </div>

  <!-- Features List -->
  <div class="plan-features">
    <h6>Features</h6>
    <ul>
      @for (feature of planViewModel.features; track feature) {
        <li>
          <nb-icon icon="checkmark-outline" status="success"></nb-icon>
          {{ feature }}
        </li>
      }
    </ul>
  </div>

  <!-- Comparison Information -->
  @if (comparisonInfo) {
    <div class="comparison-info">
      <!-- Benefits -->
      @if (comparisonInfo.benefits.length > 0) {
        <div class="benefits">
          <h6>Benefits</h6>
          <ul class="benefit-list">
            @for (benefit of comparisonInfo.benefits; track benefit) {
              <li class="benefit-item">
                <nb-icon icon="trending-up-outline" status="success"></nb-icon>
                {{ benefit }}
              </li>
            }
          </ul>
        </div>
      }
      <!-- Restrictions/Warnings -->
      @if (comparisonInfo.restrictions.length > 0) {
        <div class="restrictions">
          <h6>Important Notes</h6>
          <ul class="restriction-list">
            @for (restriction of comparisonInfo.restrictions; track restriction) {
              <li class="restriction-item">
                <nb-icon icon="alert-circle-outline" status="warning"></nb-icon>
                {{ restriction }}
              </li>
            }
          </ul>
        </div>
      }
    </div>
  }

  <!-- Action Button -->
  <div class="plan-action">
    <button
      nbButton
      [disabled]="comparisonInfo?.isDisabled"
      fullWidth
      size="medium"
      [attr.status]="comparisonInfo?.buttonVariant || 'basic'"
      [class.outline]="comparisonInfo?.actionType === PlanActionType.CURRENT"
      (click)="onPlanSelect()"
      >
      @if (getActionIcon()) {
        <nb-icon [icon]="getActionIcon()" class="action-icon"></nb-icon>
      }
      {{ comparisonInfo?.actionText || 'Select Plan' }}
    </button>
  </div>
</div>
