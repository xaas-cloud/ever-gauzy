<div class="confirmation-container">
  <!-- Action Header -->
  <div class="action-header" [ngClass]="getHeaderClass()">
    <nb-icon [icon]="getActionIcon()" size="large"></nb-icon>
    <h4>{{ getActionTitle() }}</h4>
    <p class="action-description">{{ getActionDescription() }}</p>
  </div>

  <!-- Plan Details -->
  <div class="plan-details">
    @if (currentSubscription && comparisonResult.actionType !== PlanActionType.NEW) {
      <div class="current-plan">
        <h5>Current Plan</h5>
        <div class="plan-info">
          <span class="plan-name">{{ formatSubscriptionType(currentSubscription.plan.type) }}</span>
          <span class="plan-price"
            >${{ currentSubscription.plan?.price ?? currentSubscription.amount }}/{{
            currentSubscription.plan?.billingPeriod ?? currentSubscription.billingPeriod
            }}</span
            >
          </div>
        </div>
      }

      @if (comparisonResult.actionType !== PlanActionType.NEW) {
        <div class="arrow-container">
          <nb-icon icon="arrow-forward-outline" size="large"></nb-icon>
        </div>
      }

      <div class="selected-plan">
        <h5>{{ comparisonResult.actionType === PlanActionType.NEW ? 'Selected Plan' : 'New Plan' }}</h5>
        <div class="plan-info">
          <span class="plan-name">{{ selectedPlan.name }}</span>
          <span class="plan-price">{{ selectedPlan.formattedPrice }}</span>
          @if (!selectedPlan.isFree) {
            <span class="plan-period">/{{ selectedPlan.formattedBillingPeriod }}</span>
          }
        </div>
      </div>
    </div>

    <!-- Payment Information -->
    @if (comparisonResult.requiresPayment) {
      <div class="payment-info">
        <h5>Payment Details</h5>
        <div class="payment-breakdown">
          @if (subscriptionPreview) {
            <div class="line-item">
              <span>Base amount</span>
              <span>{{ subscriptionPreview.formattedBaseAmount }}</span>
            </div>
          }
          @if (comparisonResult.prorationAmount && comparisonResult.prorationAmount > 0) {
            <div class="line-item">
              <span>Prorated amount</span>
              <span>${{ comparisonResult.prorationAmount.toFixed(2) }}</span>
            </div>
          }
          @if (subscriptionPreview?.discount && subscriptionPreview.discount > 0) {
            <div class="line-item">
              <span>Discount</span>
              <span class="discount">-{{ subscriptionPreview.formattedDiscount }}</span>
            </div>
          }
          @if (subscriptionPreview) {
            <div class="line-item total">
              <span><strong>Total</strong></span>
              <span
                ><strong>{{ subscriptionPreview.formattedTotalAmount }}</strong></span
                >
              </div>
            }
          </div>
          <!-- Payment Timing -->
          <div class="payment-timing">
            <nb-icon icon="calendar-outline"></nb-icon>
            <span>{{ getPaymentTimingText() }}</span>
          </div>
        </div>
      }

      <!-- Free Plan Information -->
      @if (selectedPlan.isFree) {
        <div class="free-plan-info">
          <div class="free-badge">
            <nb-icon icon="gift-outline" status="success"></nb-icon>
            <span>This plan is completely free!</span>
          </div>
        </div>
      }

      <!-- Benefits and Restrictions -->
      <div class="action-details">
        <!-- Benefits -->
        @if (comparisonResult.benefits.length > 0) {
          <div class="benefits">
            <h6><nb-icon icon="trending-up-outline" status="success"></nb-icon> Benefits</h6>
            <ul>
              @for (benefit of comparisonResult.benefits; track benefit) {
                <li>
                  <nb-icon icon="checkmark-circle-outline" status="success"></nb-icon>
                  {{ benefit }}
                </li>
              }
            </ul>
          </div>
        }

        <!-- Important Notes/Restrictions -->
        @if (comparisonResult.restrictions.length > 0) {
          <div class="restrictions">
            <h6><nb-icon icon="alert-circle-outline" status="warning"></nb-icon> Important Notes</h6>
            <ul>
              @for (restriction of comparisonResult.restrictions; track restriction) {
                <li>
                  <nb-icon icon="alert-triangle-outline" status="warning"></nb-icon>
                  {{ restriction }}
                </li>
              }
            </ul>
          </div>
        }
      </div>

      <!-- Trial Information -->
      @if (selectedPlan.trialDays && comparisonResult.actionType === PlanActionType.NEW) {
        <div class="trial-info">
          <nb-alert status="info" size="small">
            <nb-icon icon="clock-outline"></nb-icon>
            <strong>Free Trial:</strong> You'll get {{ selectedPlan.trialDays }} days free before billing begins.
          </nb-alert>
        </div>
      }
    </div>
