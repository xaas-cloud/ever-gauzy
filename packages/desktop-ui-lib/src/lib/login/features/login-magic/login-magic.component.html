<section class="login-container">
  <div class="login-wrapper">
    <div class="svg-wrapper">
      <gauzy-logo></gauzy-logo>
      <gauzy-switch-theme></gauzy-switch-theme>
    </div>
    <div class="headings" [class]="isDemo ? 'headings-demo' : ''">
      <div class="headings-inner">
        <h2 id="title" class="title">{{ 'LOGIN_PAGE.TITLE' | translate }}</h2>
        <p class="sub-title">{{ 'LOGIN_PAGE.LOGIN_MAGIC.TITLE' | translate }}</p>
      </div>
      @if (isCodeSent) {
        <div class="sent-code-container">
          <p
						[ngClass]="{
							'normal-text': email?.value.length < 30,
							'minimum-text': email?.value.length >= 30
						}"
            >
            {{ 'LOGIN_PAGE.LOGIN_MAGIC.SUCCESS_SENT_CODE_TITLE' | translate }}
            <b class="title">{{ email?.value }}</b>
            <br />
            <span>{{ 'LOGIN_PAGE.LOGIN_MAGIC.SUCCESS_SENT_CODE_SUB_TITLE' | translate }}</span>
          </p>
        </div>
      }
    </div>
    <div class="hr-div-strong"></div>
    <!--  -->
    <form #formDirective="ngForm" [formGroup]="form" (ngSubmit)="confirmSignInCode()">
      <!-- Email input -->
      <div class="form-control-group">
        <label class="label" for="input-email">{{ 'LOGIN_PAGE.LABELS.EMAIL' | translate }}</label>
        <nb-form-field>
          <input
            name="input-email"
            id="input-email"
            nbInput
            fullWidth
            formControlName="email"
            [placeholder]="'LOGIN_PAGE.PLACEHOLDERS.EMAIL' | translate"
            [status]="email.dirty ? (email.invalid ? 'danger' : 'success') : 'basic'"
            [attr.aria-invalid]="email.invalid && email.touched ? true : null"
            autofocus
            autocomplete="off"
            [ngClass]="isCodeSent ? 'not-allowed' : ''"
            />
            @if (isCodeSent) {
              <nb-icon
                class="edit-email"
                nbSuffix
                nbButton
                size="small"
                ghost
                icon="edit-outline"
                nbTooltip="edit email"
                nbTooltipPosition="top"
              ></nb-icon>
            }
          </nb-form-field>
          @if (email.invalid && email.touched && !email.pristine) {
            @if (email?.errors?.required) {
              <p class="caption status-danger">
                {{ 'LOGIN_PAGE.VALIDATION.EMAIL_REQUIRED' | translate }}
              </p>
            }
            @if (email?.errors?.pattern) {
              <p class="caption status-danger">
                {{ 'LOGIN_PAGE.VALIDATION.EMAIL_REAL_REQUIRED' | translate }}
              </p>
            }
          }
        </div>
        <!-- Code input -->
        @if (isCodeSent) {
          <div class="form-control-group">
            <label class="label" for="input-code">{{ 'LOGIN_PAGE.LABELS.CODE' | translate }}</label>
            <input
              name="input-code"
              id="input-code"
              nbInput
              fullWidth
              formControlName="code"
              noSpaceEdges
              [placeholder]="'LOGIN_PAGE.PLACEHOLDERS.CODE' | translate"
              [status]="code.dirty ? (code.invalid ? 'danger' : 'success') : 'basic'"
              [attr.aria-invalid]="code.invalid && code.touched ? true : null"
              maxlength="6"
              autofocus
              autocomplete="off"
              />
              @if (code.invalid && code.touched) {
                @if (code.errors?.required) {
                  <p class="caption status-danger">
                    {{ 'LOGIN_PAGE.VALIDATION.CODE_REQUIRED' | translate }}
                  </p>
                }
                @if (code.errors?.minlength) {
                  <p class="caption status-danger">
                    {{
                    'LOGIN_PAGE.VALIDATION.CODE_REQUIRED_LENGTH'
                    | translate : { requiredLength: code.errors?.minlength?.requiredLength }
                    }}
                  </p>
                }
              }
              <!-- Resend Code Button & Text -->
              @if (isCodeSent) {
                <p class="new-code-wrapper">
                  @if (isCodeResent) {
                    <span class="request-new-code">
                      {{
                      'LOGIN_PAGE.LOGIN_MAGIC.REQUEST_NEW_CODE_TITLE'
                      | translate : { countdown: countdown }
                      }}
                    </span>
                  } @else {
                    <a class="resend-code" debounceClick (throttledClick)="onResendCode()">
                      {{ 'LOGIN_PAGE.LOGIN_MAGIC.RESEND_CODE_TITLE' | translate }}
                    </a>
                  }
                </p>
              }
            </div>
          }
          <!-- Submit Button -->
          <div class="submit-btn-wrapper">
            <a class="forgot-email caption-2 forgot-email-big" href="mailto:forgot@gauzy.co">
              {{ 'LOGIN_PAGE.FORGOT_EMAIL_TITLE' | translate }}
            </a>
            <div class="submit-inner-wrapper">
              @if (isCodeSent) {
                <button
                  type="submit"
                  nbButton
                  size="tiny"
                  class="submit-btn"
                  [disabled]="form.invalid || isLoading"
                  >
                  <span class="btn-text">
                    {{ 'BUTTONS.LOGIN' | translate }}
                  </span>
                  @if (isLoading) {
                    <nb-icon [ngStyle]="{ display: 'none' }" *gauzySpinnerButton="isLoading"></nb-icon>
                  }
                </button>
              } @else {
                <button
                  type="button"
                  nbButton
                  size="tiny"
                  class="submit-btn"
                  [disabled]="email.invalid || isLoading"
                  (click)="sendLoginCode()"
                  >
                  <span class="btn-text">
                    {{ 'BUTTONS.SEND_CODE' | translate }}
                  </span>
                  @if (isLoading) {
                    <nb-icon [ngStyle]="{ display: 'none' }" *gauzySpinnerButton="isLoading"></nb-icon>
                  }
                </button>
              }
            </div>
          </div>
          <div class="magic-description">
            <p class="sub-title">
              {{ 'LOGIN_PAGE.LOGIN_MAGIC.DESCRIPTION_TITLE' | translate }}
              <span class="sub-title">
                <a routerLink="/auth/login">
                  {{ 'LOGIN_PAGE.LOGIN_MAGIC.OR_SIGN_IN_WITH_PASSWORD' | translate }}
                </a>
              </span>
            </p>
          </div>
        </form>
        <div class="hr-div-soft"></div>
        <section>
          <ngx-social-links></ngx-social-links>
        </section>
        <div class="hr-div-soft"></div>
        <section class="another-action" aria-label="Register">
          {{ 'LOGIN_PAGE.DO_NOT_HAVE_ACCOUNT_TITLE' | translate }}
          <a class="text-link" routerLink="/auth/register">
            {{ 'BUTTONS.REGISTER' | translate }}
          </a>
        </section>
      </div>
    </section>
