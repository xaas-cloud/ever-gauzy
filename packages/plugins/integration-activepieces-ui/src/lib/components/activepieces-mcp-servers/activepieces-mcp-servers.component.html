<nb-card class="card-scroll">
  <nb-card-header class="d-flex">
    <ngx-back-navigation></ngx-back-navigation>
    <h5>{{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.TITLE' | translate }}</h5>
  </nb-card-header>
  <nb-card-body>
    <!-- Project ID Input Form -->
    <div class="col-xl-6 col-12">
      <div class="form-group">
        <label for="projectId" class="label">
          {{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.PROJECT_ID' | translate }}
        </label>
        <div class="input-group">
          <input
            fullWidth
            id="projectId"
            [(ngModel)]="projectId"
            type="text"
            nbInput
            [placeholder]="'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.PROJECT_ID_PLACEHOLDER' | translate"
            />
            <button
              nbButton
              status="primary"
              size="small"
              outline
              (click)="loadMcpServers()"
              [disabled]="loading || !projectId"
              >
              {{ 'BUTTONS.LOAD' | translate }}
            </button>
          </div>
          <small class="form-text text-muted">
            {{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.PROJECT_ID_HINT' | translate }}
          </small>
        </div>
      </div>

      <!-- Loading Spinner -->
      @if (loading) {
        <div class="text-center mt-3">
          <nb-spinner size="large" status="primary"></nb-spinner>
          <p class="mt-2">{{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.LOADING' | translate }}</p>
        </div>
      }

      <!-- No Servers Message -->
      @if (!loading && mcpServers.length === 0) {
        <div class="text-center mt-3">
          <nb-icon icon="swap-outline" status="basic" style="font-size: 3rem;"></nb-icon>
          <p class="mt-2">{{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.NO_SERVERS' | translate }}</p>
        </div>
      }

      <!-- MCP Servers List -->
      @if (!loading && mcpServers.length > 0) {
        <div class="mcp-servers-list mt-3">
          <div class="row">
            @for (server of mcpServers; track trackByServerId($index, server)) {
              <div class="col-xl-4 col-lg-6 col-12">
                <nb-card class="mcp-server-card">
                  <nb-card-header>
                    <div class="d-flex align-items-center justify-content-between">
                      <span class="server-name">{{ server.name }}</span>
                      @if (server.id) {
                        <nb-badge status="success">
                          {{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.ACTIVE' | translate }}
                        </nb-badge>
                      }
                    </div>
                  </nb-card-header>
                  <nb-card-body>
                    <div class="server-info">
                      <div class="info-row">
                        <span class="info-label">
                          {{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.SERVER_ID' | translate }}:
                        </span>
                        <span class="info-value">{{ server.id }}</span>
                      </div>
                      @if (server.agentId) {
                        <div class="info-row">
                          <span class="info-label">
                            {{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.AGENT_ID' | translate }}:
                          </span>
                          <span class="info-value">{{ server.agentId }}</span>
                        </div>
                      }
                      @if (server.tools) {
                        <div class="info-row">
                          <span class="info-label">
                            {{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.TOOLS_COUNT' | translate }}:
                          </span>
                          <span class="info-value">{{ server.tools.length }}</span>
                        </div>
                      }
                      @if (server.created) {
                        <div class="info-row">
                          <span class="info-label">
                            {{ 'INTEGRATIONS.ACTIVEPIECES_PAGE.MCP_SERVERS.CREATED' | translate }}:
                          </span>
                          <span class="info-value">{{ server.created | date:'medium' }}</span>
                        </div>
                      }
                    </div>
                  </nb-card-body>
                </nb-card>
              </div>
            }
          </div>
        </div>
      }
    </nb-card-body>
  </nb-card>
