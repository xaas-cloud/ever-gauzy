<nb-layout windowMode>
  @if (user$ | async) {
    <nb-layout-header fixed>
      <ngx-header [expanded]="isExpanded"></ngx-header>
    </nb-layout-header>
  }

  @if (user$ | async) {
    <nb-sidebar
      class="menu-sidebar sidebar_class"
      tag="menu-sidebar"
      (stateChange)="onStateChange($event)"
      >
      <div class="custom-box">
        <div class="custom-row logo">
          <div
            [ngClass]="isExpanded? isCollapse? 'logo-container':'logo-container not-collapsed' : 'logo-container compacted'"
            >
            <ngx-gauzy-logo
              [controlled]="trigger"
              (onCollapsed)="onCollapse($event)"
              (onWorkspaceToggle)="onWorkspaceToggle($event)"
            ></ngx-gauzy-logo>
            @if (isCollapse && isExpanded) {
              <button class="hidden-menu" outline nbButton underConstruction>
                <i class="fas fa-ellipsis-h"></i>
              </button>
            }
          </div>
        </div>
        <div class="custom-row menu">
          <ng-content select="ga-main-nav-menu"></ng-content>
        </div>
        <div [ngClass]="isExpanded ? 'toggle-layout row' : 'toggle-layout column'">
          <div class="custom-row user">
            <gauzy-user [user$]="user$" (click)="isOpen = !isOpen"></gauzy-user>
          </div>
          <div class="custom-row button">
            <div [ngClass]="isExpanded ? 'chevron' : 'chevron collapsed'">
              <button (click)="toggle()" nbButton outline size="small">
                <i [ngClass]="isExpanded ? 'fas fa-angle-double-left' : 'fas fa-angle-double-right'"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </nb-sidebar>
  }

  @if (!loading) {
    <nb-layout-column>
      <ng-content select="router-outlet"></ng-content>
    </nb-layout-column>
  }

  <nb-layout-footer fixed>
    <ngx-footer></ngx-footer>
  </nb-layout-footer>

  @for (sidebar of (navigationBuilderService.sidebars$ | async); track sidebar) {
    <nb-sidebar
      [class]="sidebar.class"
      [tag]="sidebar.id"
      state="collapsed"
      fixed
      [end]="true"
      >
      <ngx-theme-sidebar [config]="sidebar"></ngx-theme-sidebar>
    </nb-sidebar>
  }
</nb-layout>
@if (isOpen) {
  <gauzy-user-menu [user$]="user$" (close)="isOpen=false"></gauzy-user-menu>
}
@if (isWorkspaceOpen) {
  <gauzy-workspace-menu (close)="isWorkspaceOpen=false"></gauzy-workspace-menu>
}
