<nb-card class="card-scroll">
  <nb-card-header>
    <div class="row">
      <div class="col-auto">
        <h4>
          <ngx-header-title>
            {{ title | translate }}
          </ngx-header-title>
        </h4>
        @if (request?.startDate && request?.endDate) {
          <ngx-date-range-title
            [start]="request?.startDate"
            [end]="request?.endDate"
            [format]="'dddd, LL'"
          ></ngx-date-range-title>
        }
      </div>
    </div>
    <div class="row">
      <div class="col-auto ml-auto">
        <ngx-gauzy-filters
          [filters]="filters"
          [saveFilters]="(datePickerConfig$ | async).isSaveDatePicker"
          (filtersChange)="filtersChange($event)"
        ></ngx-gauzy-filters>
      </div>
    </div>
  </nb-card-header>
  <nb-card-body class="report-body">
    <div class="report-container">
      <div class="table">
        @if (loading) {
          <div
            class="time-logs row-table"
            [nbSpinner]="loading"
            [nbSpinnerSize]="'giant'"
            [nbSpinnerStatus]="'primary'"
          ></div>
        }
        @if (dailyData?.length > 0) {
          @for (day of dailyData; track day) {
            <nb-card class="card">
              <nb-card-header class="card-title">
                {{ day.date | dateFormat }}
              </nb-card-header>
              <nb-card-body class="budget-container">
                @if (day.employees?.length > 0) {
                  <div class="columns-header">
                    <div class="table-inner-wrapper font-weight-bold align-items-center">
                      @if (duration === 'week') {
                        <ng-container *ngTemplateOutlet="weeklyHeadings"></ng-container>
                      }
                      @if (duration === 'day') {
                        <ng-container *ngTemplateOutlet="dailyHeadings"></ng-container>
                      }
                    </div>
                  </div>
                } @else {
                  <div class="ml-3">
                    {{ 'REPORT_PAGE.NO_EMPLOYEES_WORKED' | translate }}
                  </div>
                }
                <div class="cart-body project-row">
                  @for (timeLogRow of day.employees; track timeLogRow) {
                    <div class="table-row">
                      <div class="table-inner-wrapper">
                        @if (duration === 'week') {
                          <ng-container
                            *ngTemplateOutlet="weeklyTable; context: { $implicit: timeLogRow }"
                            >
                          </ng-container>
                        }
                        @if (duration === 'day') {
                          <ng-container
                            *ngTemplateOutlet="dailyTable; context: { $implicit: timeLogRow }"
                            >
                          </ng-container>
                        }
                      </div>
                    </div>
                  }
                </div>
              </nb-card-body>
            </nb-card>
          }
        } @else {
          <nb-card>
            <nb-card-body>
              <div class="row font-weight-bold py-5 align-items-center">
                <div class="col text-center">
                  {{ 'REPORT_PAGE.NO_EMPLOYEES' | translate }}
                </div>
              </div>
            </nb-card-body>
          </nb-card>
        }
      </div>
    </div>
  </nb-card-body>
</nb-card>

<ng-template let-project #projectEl>
  @if (project) {
    <ga-project-column-view [project]="project"></ga-project-column-view>
  } @else {
    <span>{{ 'REPORT_PAGE.NO_PROJECT' | translate }}</span>
  }
</ng-template>

<ng-template let-task #taskEl>
  @if (task) {
    <span>{{ task?.title }} </span>
  } @else {
    <span>{{ 'REPORT_PAGE.NO_TASK' | translate }}</span>
  }
</ng-template>

<ng-template let-employee #employeeEl>
  <div class="avatar-wrapper-outer">
    @if (employee) {
      <ngx-avatar
        class="report-table"
        [src]="employee?.user?.imageUrl"
        [name]="employee?.user?.name"
        [id]="employee?.id"
        [employee]="employee"
        >
      </ngx-avatar>
    }
  </div>
  <ng-template #noEmployee>
    <span>{{ 'REPORT_PAGE.NO_EMPLOYEE' | translate }}</span>
  </ng-template>
</ng-template>

<ng-template #weeklyHeadings>
  <div class="responsive-table-row employee-column">
    {{ 'REPORT_PAGE.EMPLOYEE' | translate }}
  </div>
  <div class="responsive-table-row limit-column">
    {{ 'REPORT_PAGE.LIMIT' | translate }}
  </div>
  <div class="responsive-table-row spent-column">
    {{ 'REPORT_PAGE.SPENT_HOURS' | translate }}
  </div>
  <div class="responsive-table-row activity-column">
    {{ 'REPORT_PAGE.ACTIVITY' | translate }}
  </div>
  <div class="responsive-table-row remaining-column">
    {{ 'REPORT_PAGE.REMAINING_HOURS' | translate }}
  </div>
</ng-template>
<ng-template let-timeLogRow #weeklyTable>
  <div class="responsive-table-row employee-column">
    <div class="responsive-table-header">
      {{ 'REPORT_PAGE.EMPLOYEE' | translate }}
    </div>
    <div class="responsive-table-content project-name">
      <ng-container *ngTemplateOutlet="employeeEl; context: { $implicit: timeLogRow?.employee }"> </ng-container>
    </div>
  </div>
  <div class="responsive-table-row limit-column">
    <div class="responsive-table-header">{{ 'REPORT_PAGE.LIMIT' | translate }}</div>
    <div class="responsive-table-content project-name">
      {{ timeLogRow.limit | durationFormat }}
    </div>
  </div>
  <div class="responsive-table-row spent-column">
    <div class="responsive-table-header">{{ 'REPORT_PAGE.SPENT_HOURS' | translate }}</div>
    <div class="responsive-table-content project-name">
      <span class="duration-span">{{ timeLogRow.duration | durationFormat }}</span>
    </div>
  </div>
  <div class="responsive-table-row activity-column">
    <div class="responsive-table-header">{{ 'REPORT_PAGE.ACTIVITY' | translate }}</div>
    <div class="responsive-table-content project-name">
      <ngx-progress-status
        class="w-100 report-progress"
        defaultStatus="success"
        [percentage]="timeLogRow.durationPercentage"
        >
      </ngx-progress-status>
    </div>
  </div>
  <div class="responsive-table-row remaining-column remaining-content">
    <div class="responsive-table-header">{{ 'REPORT_PAGE.TO_DO' | translate }}</div>
    <div class="responsive-table-content day-col">
      {{
      timeLogRow.limit - timeLogRow.duration > 0
      ? (timeLogRow.limit - timeLogRow.duration | durationFormat)
      : 0
      }}
    </div>
  </div>
</ng-template>

<ng-template #dailyHeadings>
  <div class="responsive-table-row employee-column">
    {{ 'REPORT_PAGE.EMPLOYEE' | translate }}
  </div>
  <div class="responsive-table-row activity-column">
    {{ 'REPORT_PAGE.ACTIVITY' | translate }}
  </div>
  <div class="responsive-table-row spent-column">
    8
    {{ 'REPORT_PAGE.SPENT_HOURS' | translate }}
  </div>
  <div class="responsive-table-row remaining-column">
    {{ 'REPORT_PAGE.REMAINING_HOURS' | translate }}
  </div>
  <div class="responsive-table-row limit-column">
    {{ 'REPORT_PAGE.LIMIT' | translate }}
  </div>
</ng-template>
<ng-template let-timeLogRow #dailyTable>
  <div class="responsive-table-row employee-column">
    <div class="responsive-table-header">
      {{ 'REPORT_PAGE.EMPLOYEE' | translate }}
    </div>
    <div class="responsive-table-content project-name">
      <ng-container *ngTemplateOutlet="employeeEl; context: { $implicit: timeLogRow?.employee }"> </ng-container>
    </div>
  </div>
  <div class="responsive-table-row activity-column">
    <div class="responsive-table-header">{{ 'REPORT_PAGE.ACTIVITY' | translate }}</div>
    <div class="responsive-table-content project-name">
      <ngx-progress-status
        class="w-100 report-progress"
        defaultStatus="success"
        [percentage]="timeLogRow.durationPercentage"
        >
      </ngx-progress-status>
    </div>
  </div>
  <div class="responsive-table-row spent-column">
    <div class="responsive-table-header">{{ 'REPORT_PAGE.SPENT_HOURS' | translate }}</div>
    <div class="responsive-table-content project-name">
      <span class="duration-span">{{ timeLogRow.duration | durationFormat }}</span>
    </div>
  </div>
  <div class="responsive-table-row remaining-column">
    <div class="responsive-table-header">{{ 'REPORT_PAGE.TO_DO' | translate }}</div>
    <div class="responsive-table-content day-col">
      {{
      timeLogRow.limit - timeLogRow.duration > 0
      ? (timeLogRow.limit - timeLogRow.duration | durationFormat)
      : 0
      }}
    </div>
  </div>
  <div class="responsive-table-row limit-column">
    <div class="responsive-table-header">{{ 'REPORT_PAGE.LIMIT' | translate }}</div>
    <div class="responsive-table-content project-name">
      {{ timeLogRow.limit | durationFormat }}
    </div>
  </div>
</ng-template>
