<nb-card>
  <nb-card-header class="p-0">
    <div class="filters">
      <div class="add-button">
        <ng-template
          [ngxPermissionsOnly]="PermissionsEnum.ALLOW_MANUAL_TIME"
          >
          <ng-template
            ngxTimeTrackingAuthorized
            [permission]="PermissionsEnum.ALLOW_MANUAL_TIME"
            >
            <button
              nbButton
              status="success"
              size="small"
              (click)="openAddEdit()"
              >
              <nb-icon icon="plus-outline"></nb-icon>
              {{ 'TIMESHEET.ADD_TIME' | translate }}
            </button>
          </ng-template>
        </ng-template>
      </div>
      <ngx-gauzy-filters
        [saveFilters]="(datePickerConfig$ | async).isSaveDatePicker"
        (filtersChange)="filtersChange($event)"
      ></ngx-gauzy-filters>
    </div>
  </nb-card-header>
  <nb-card-body class="weekly-logs row-table timesheet-weekly-container">
    <div class="custom-header-container">
      <div class="row custom-header m-0 align-items-center">
        <div class="col-sm-3 project-name">
          {{ 'TIMESHEET.PROJECT' | translate }} /
          {{ 'TIMESHEET.TODO' | translate }}
        </div>
        @for (date of weekDayList; track date) {
          <div
            class="col text-center day-col"
            >
            {{ date | dateFormat }}
          </div>
        }
      </div>
    </div>

    <div
      [nbSpinner]="loading"
      nbSpinnerSize="giant"
      nbSpinnerStatus="primary"
      class="custom-body"
      >
      @if (weekData?.length > 0) {
        <div class="content">
          @for (day of weekData; track day) {
            <div
						[class]="
							weekData.at(-1) == day
								? 'row m-0 py-3 align-items-center'
								: 'row border-bottom m-0 py-3 align-items-center'
						"
              >
              <div class="col-sm-3 project-name">
                @if (day?.project) {
                  <ngx-project
                    [rowData]="day"
                  ></ngx-project>
                } @else {
                  <span>
                    {{ 'TIMESHEET.NO_PROJECT' | translate }}
                  </span>
                }
              </div>
              @for (date of weekDayList; track date) {
                <div
                  class="col text-center day-col"
                  >
                  @if (day.dates[date]?.sum > 0) {
                    <button
                      nbButton
                      ghost
                      status="basic"
                      [nbPopover]="viewTimeLogComponent"
								[nbPopoverContext]="{
									timeLogs: day.dates[date]?.logs,
									callback: addTimeCallback,
									close: onClose
								}"
                      #popover
                      >
                      {{ day.dates[date]?.sum | durationFormat }}
                    </button>
                  } @else {
                    <ng-template
									[ngxPermissionsOnly]="
										PermissionsEnum.ALLOW_MANUAL_TIME
									"
									[ngxPermissionsOnlyElse]="
										notAllowAddTimeBlock
									"
                      >
                      <ng-template
                        ngxTimeTrackingAuthorized
										[permission]="
											PermissionsEnum.ALLOW_MANUAL_TIME
										"
                        [permissionElse]="notAllowAddTimeBlock"
                        >
                        @if (
                          allowAdd(date)) {
                          <button
                            nbButton
                            outline
                            size="small"
                            status="primary"
											(click)="
												openAddByDateProject(
													date,
													day?.project
												)
											"
                            >
                            <nb-icon
                              icon="plus-outline"
                            ></nb-icon>
                          </button>
                        } @else {
                          -
                        }
                      </ng-template>
                    </ng-template>
                  }
                </div>
              }
            </div>
          }
        </div>
      } @else {
        <ngx-no-data-message
          [message]="'TIMESHEET.NO_DATA.WEEKLY_TIMESHEET' | translate"
        ></ngx-no-data-message>
      }
    </div>
  </nb-card-body>
</nb-card>
